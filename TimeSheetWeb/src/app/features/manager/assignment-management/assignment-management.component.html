<div class="container">
  <div class="header">
    <h2>Project Assignments</h2>
    <button class="btn btn-primary" (click)="toggleForm()" [disabled]="isLoading">
      {{ showForm ? 'Cancel' : 'New Assignment' }}
    </button>
  </div>

  <!-- Success/Error Messages -->
  @if (successMessage) {
  <div class="alert alert-success">
    {{ successMessage }}
  </div>
  }

  @if (errorMessage) {
  <div class="alert alert-danger">
    {{ errorMessage }}
  </div>
  }

  <!-- Assignment Form -->
  @if (showForm) {
  <div class="form-card">
    <h3>{{ isEditMode ? 'Edit Assignment' : 'Create New Assignment' }}</h3>
    <form [formGroup]="assignmentForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="userId">Employee *</label>
        <select id="userId" formControlName="userId" class="form-control" [disabled]="isLoading">
          <option value="">Select an employee</option>
          @for (employee of employees; track employee.id) {
          <option [value]="employee.id">{{ employee.name }} ({{ employee.email }})</option>
          }
        </select>
        @if (assignmentForm.get('userId')?.invalid && assignmentForm.get('userId')?.touched) {
        <small class="error-text">Employee is required</small>
        }
      </div>

      <div class="form-group">
        <label for="projectId">Project *</label>
        <select id="projectId" formControlName="projectId" class="form-control" [disabled]="isLoading">
          <option value="">Select a project</option>
          @for (project of projects; track project.id) {
          <option [value]="project.id">{{ project.projectName }}</option>
          }
        </select>
        @if (assignmentForm.get('projectId')?.invalid && assignmentForm.get('projectId')?.touched) {
        <small class="error-text">Project is required</small>
        }
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="startDate">Start Date *</label>
          <input type="date" id="startDate" formControlName="startDate" class="form-control" [disabled]="isLoading">
          @if (assignmentForm.get('startDate')?.invalid && assignmentForm.get('startDate')?.touched) {
          <small class="error-text">Start Date is required</small>
          }
        </div>

        <div class="form-group">
          <label for="endDate">End Date</label>
          <input type="date" id="endDate" formControlName="endDate" class="form-control" [disabled]="isLoading">
        </div>
      </div>

      <div class="form-group">
        <label for="isActive">
          <input type="checkbox" id="isActive" formControlName="isActive" [disabled]="isLoading">
          Active
        </label>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-success" [disabled]="assignmentForm.invalid || isLoading">
          {{ isLoading ? 'Saving...' : (isEditMode ? 'Update' : 'Create') }}
        </button>
        @if (isEditMode) {
        <button type="button" class="btn btn-danger" (click)="deleteAssignment()" [disabled]="isLoading">
          {{ isLoading ? 'Deleting...' : 'Delete' }}
        </button>
        }
      </div>
    </form>
  </div>
  }

  <!-- Assignments List -->
  <div class="assignments-section">
    @if (isLoading && assignments.length === 0) {
    <div class="loading">Loading assignments...</div>
    }

    @if (assignments.length > 0) {
    <div class="table-responsive">
      <table class="assignments-table">
        <thead>
          <tr>
            <th>Employee</th>
            <th>Project</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (assignment of assignments; track assignment.id) {
          <tr [class.inactive]="!assignment.isActive">
            <td>{{ assignment.userName }}</td>
            <td>{{ assignment.projectName }}</td>
            <td>{{ assignment.startDate | date: 'MMM dd, yyyy' }}</td>
            <td>{{ assignment.endDate ? (assignment.endDate | date: 'MMM dd, yyyy') : 'N/A' }}</td>
            <td>
              <span class="badge" [class.active]="assignment.isActive" [class.inactive]="!assignment.isActive">
                {{ assignment.isActive ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td class="actions">
              <button class="btn btn-sm btn-edit" (click)="editAssignment(assignment)" [disabled]="isLoading">
                Edit
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @else if (!isLoading && assignments.length === 0) {
    <div class="empty-state">
      <p>No assignments yet. Create one to get started.</p>
    </div>
    }
  </div>
</div>